# Configuración de Tablas Personalizable

## Descripción

Esta funcionalidad permite a cada usuario personalizar la configuración de las tablas en la aplicación, incluyendo:

- **Columnas visibles**: Mostrar/ocultar columnas específicas
- **Orden de columnas**: Reordenar columnas mediante drag & drop
- **Tamaño de página**: Configurar el número de registros por página
- **Ordenación por defecto**: Establecer columna y dirección de ordenación predeterminada
- **Ancho de columnas**: Definir anchos personalizados para cada columna
- **Capacidad de ordenación**: Habilitar/deshabilitar ordenación por columna

## Arquitectura

### Backend

#### Entidades
- **TableConfiguration**: Configuración general de la tabla
- **TableColumnConfiguration**: Configuración específica de cada columna

#### Servicios
- **TableConfigurationService**: Lógica de negocio para gestionar configuraciones
- Utiliza ModelMapper para conversiones automáticas
- Implementa logging con SLF4J
- Extiende BaseService para funcionalidades comunes

#### Controladores
- **TableConfigurationController**: API REST con documentación Swagger
- Endpoints para CRUD de configuraciones

#### Repositorios
- **TableConfigurationRepository**: Consultas optimizadas con índices
- Métodos personalizados para búsquedas eficientes

### Frontend

#### Servicios
- **tableConfigurationService**: Cliente para la API de configuraciones
- Configuraciones por defecto para cada tipo de tabla
- Manejo de errores y fallbacks

#### Componentes
- **TableConfigurationModal**: Modal de configuración con drag & drop
- **DataTable**: Tabla mejorada con integración de configuraciones

## Uso

### Para Usuarios

1. **Acceder a la configuración**: Hacer clic en el botón "Configurar" en cualquier tabla
2. **Personalizar columnas**: 
   - Marcar/desmarcar columnas visibles
   - Arrastrar columnas para reordenarlas
   - Configurar anchos personalizados
3. **Configuración general**:
   - Establecer filas por página
   - Definir ordenación por defecto
4. **Guardar cambios**: Los cambios se aplican inmediatamente y se persisten

### Para Desarrolladores

#### Agregar configuración a una nueva tabla

1. **Definir columnas por defecto** en `TableConfigurationService.getDefaultColumnsForTable()`
2. **Agregar configuración por defecto** en `tableConfigurationService.getDefaultConfiguration()`
3. **Pasar tableName** al componente DataTable
4. **Manejar eventos** de configuración si es necesario

#### Ejemplo de implementación

```vue
<DataTable
  :items="items"
  :columns="columns"
  table-name="myTable"
  @configuration-changed="onConfigurationChanged"
/>
```

## Base de Datos

### Migración
```sql
-- Tabla principal de configuraciones
CREATE TABLE table_configurations (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id BIGINT NOT NULL,
    table_name VARCHAR(100) NOT NULL,
    page_size INT NOT NULL DEFAULT 10,
    default_sort_key VARCHAR(100),
    default_sort_order VARCHAR(10) NOT NULL DEFAULT 'ASC',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE(user_id, table_name)
);

-- Configuración de columnas
CREATE TABLE table_column_configurations (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    table_configuration_id BIGINT NOT NULL,
    column_key VARCHAR(100) NOT NULL,
    column_label VARCHAR(100) NOT NULL,
    visible BOOLEAN NOT NULL DEFAULT TRUE,
    sortable BOOLEAN NOT NULL DEFAULT TRUE,
    sort_order INT,
    width VARCHAR(50),
    is_default BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (table_configuration_id) REFERENCES table_configurations(id) ON DELETE CASCADE
);
```

### Índices
- `idx_table_config_user_table`: Optimiza búsquedas por usuario y tabla
- `idx_column_config_table_id`: Optimiza búsquedas de columnas por configuración
- `idx_column_config_key`: Optimiza búsquedas por clave de columna

## Características Técnicas

### Seguridad
- Configuraciones aisladas por usuario
- Validación de entrada con Bean Validation
- Autenticación requerida para todas las operaciones

### Rendimiento
- Configuraciones cacheadas por sesión
- Consultas optimizadas con índices
- Lazy loading de relaciones

### Escalabilidad
- Diseño normalizado para múltiples tablas
- Configuraciones independientes por usuario
- Fácil extensión para nuevas funcionalidades

## Testing

### Backend
- Tests unitarios para el servicio
- Cobertura de casos principales
- Mocks para dependencias externas

### Frontend
- Tests de integración para el modal
- Validación de funcionalidad drag & drop
- Tests de persistencia de configuración

## Roadmap

### Futuras Mejoras
- [ ] Configuraciones compartidas entre usuarios
- [ ] Plantillas de configuración predefinidas
- [ ] Exportar/importar configuraciones
- [ ] Configuraciones por rol de usuario
- [ ] Historial de cambios de configuración

### Optimizaciones
- [ ] Cache distribuido para configuraciones
- [ ] Compresión de configuraciones complejas
- [ ] Lazy loading de configuraciones no críticas
- [ ] Batch operations para múltiples tablas

## Troubleshooting

### Problemas Comunes

1. **Configuración no se guarda**
   - Verificar permisos de usuario
   - Revisar logs del backend
   - Validar formato de datos

2. **Columnas no se reordenan**
   - Verificar JavaScript console
   - Comprobar eventos drag & drop
   - Validar estado del componente

3. **Configuración no se carga**
   - Verificar conexión a la API
   - Revisar logs del frontend
   - Comprobar autenticación

### Logs Relevantes

```java
// Backend
log.info("Configuración de tabla '{}' obtenida para el usuario: {}", tableName, userId);
log.error("Error al guardar configuración de tabla '{}' para el usuario: {}", tableName, userId, e);

// Frontend
console.error('Error al obtener configuración de tabla:', error);
console.error('Error al guardar configuración de tabla:', error);
```
